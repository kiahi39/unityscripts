// console $ pug -w ./ -o ./ -P

doctype html
html(lang='ja')
    head
        meta(charset='UTF-8')
        meta(name='viewport', content='width=device-width, initial-scale=1.0')
        title もちメニュー
        meta(name='description', content=description)
        meta(name='keywords', content=keywords)

        link(rel="stylesheet" href="./layout.css")
        link(rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css")

    body
        #mochi_menu
            div(v-for="item in menu_items")
                i.menu-icon.far(v-bind:class="item.classname")
            #blob-loader
                .menu-rect(
                    v-bind:class="{'anime_swell': click_flash}")
                .menu-block
                    div(v-for="(item, index) in menu_items")
                        .click-box(
                            v-bind:class="`position-${index+1}`" 
                            v-on:click=`menu_click(index+1)`)
                    .mochi(
                        v-bind:class="[position_class, {'anime_drop': click_flash}]")

            svg(xmins="http://www.w3.org/2000/svg", version="1.1")
                defs  
                    filter#blob
                        fegaussianblur(in="SourceGraphic" result="blur" stdDeviation="8")
                        fecolormatrix(in="blur" result="blob" mode="matrix" 
                            values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 40 -10")
                

        script(src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js")
        script.
            const mochi_menu = new Vue({
                el: '#mochi_menu',
                data: {
                    menu_items : [
                        {
                            classname: {"fa-square": true}
                        },
                        {
                            classname: {"fa-bell": true}
                        },
                        {    
                            classname: {"fa-bookmark": true}
                        }
                    ],
                    active_menu: 1,
                    click_flash: false,
                    on_animation: false,
                    anime_reqired_time: 1000
                },
                created: function (n) {
                    console.log("created.");
                },
                methods: {
                    menu_click: function (n) {
                        if(this.on_animation) {
                            return;
                        }
                        this.start_click_flash();
                        this.start_anime_timer();
                        this.active_menu = n;
                        console.log("[active_menu] = ",this.active_menu);
                    },
                    start_click_flash: function () {
                        this.click_flash = false;
                        setTimeout(
                            ()=>{ this.click_flash = true;},
                            1
                        );
                        
                    },
                    start_anime_timer: function () {
                        this.on_animation = true;
                        setTimeout(
                            ()=>{ 
                                this.on_animation = false;
                                console.log("stop anime timer");
                            },
                            this.anime_reqired_time
                        );
                        console.log("start anime timer");
                    }
                },
                computed: {
                    position_class: function() {
                        let array = [];
                        for (let i=1; i<=this.menu_items.length; i++ ){
                            if(this.active_menu == i){
                                array.push(`position-${i}`);
                            }
                        }
                        return array;
                    }
                },

            })
